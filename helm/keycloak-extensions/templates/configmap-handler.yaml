# SPDX-License-Identifier: AGPL-3.0-only
# SPDX-FileCopyrightText: 2023 Univention GmbH

---

apiVersion: "v1"
kind: ConfigMap
metadata:
  name: {{ printf "%s-handler" (include "common.names.fullname" .) }}
  namespace: {{ include "common.names.namespace" . | quote }}
  labels:
    {{- include "common.labels.standard" . | nindent 4 }}
    {{- if .Values.handler.additionalLabels }}
    {{- include "common.tplvalues.render" ( dict "value" .Values.handler.additionalLabels "context" . ) | nindent 4 }}
    {{- end }}
  {{- if .Values.handler.additionalAnnotations }}
  annotations: {{- include "common.tplvalues.render" ( dict "value" .Values.handler.additionalAnnotations "context" . ) | nindent 4 }}
  {{- end }}
data:
  KC_AUTH_URL: "http://{{ required "A value for .Values.keycloak.host or .Values.global.keycloak.host must be configured." (coalesce .Values.keycloak.host .Values.global.keycloak.host) }}/admin"
  KC_USER: "{{ required "A value for .Values.keycloak.adminUsername or .Values.global.keycloak.adminUsername must be configured." (coalesce .Values.keycloak.adminUsername .Values.global.keycloak.adminUsername) }}"
  KC_PASS: "{{ required "A value for .Values.keycloak.adminPassword or .Values.global.keycloak.adminPassword must be configured." (coalesce .Values.keycloak.adminPassword .Values.global.keycloak.adminPassword) }}"
  KC_REALM: "{{ required "A value for .Values.keycloak.realm or .Values.global.keycloak.realm must be configured." (coalesce .Values.keycloak.realm .Values.global.keycloak.realm) }}"
  KC_USER_REALM: "{{ required "A value for .Values.keycloak.adminRealm or .Values.global.keycloak.adminRealm must be configured." (coalesce .Values.keycloak.adminRealm .Values.global.keycloak.adminRealm) }}"
  POSTGRES_HOST: "{{ required "A value for .Values.postgresql.connection.host or .Values.global.postgresql.connection.host must be configured." (coalesce .Values.postgresql.connection.host .Values.global.postgresql.connection.host) }}"
  POSTGRES_PORT: "{{ required "A value for .Values.postgresql.connection.port or .Values.global.postgresql.connection.port must be configured." (coalesce .Values.postgresql.connection.port .Values.global.postgresql.connection.port) }}"
  POSTGRES_USER: "{{ required "A value for .Values.postgresql.auth.username or .Values.global.postgresql.auth.username must be configured." (coalesce .Values.postgresql.auth.username .Values.global.postgresql.auth.username) }}"
  POSTGRES_PASSWORD: "{{ required "A value for .Values.postgresql.auth.password or .Values.global.postgresql.auth.password must be configured." (coalesce .Values.postgresql.auth.password .Values.global.postgresql.auth.password) }}"
  POSTGRES_DATABASE_NAME: "{{ required "A value for .Values.postgresql.auth.database or .Values.global.postgresql.auth.database must be configured." (coalesce .Values.postgresql.auth.database .Values.global.postgresql.auth.database) }}"
  LOG_LEVEL: "{{ .Values.handler.appConfig.logLevel }}"
  FAILED_ATTEMPTS_FOR_IP_BLOCK: "{{ .Values.handler.appConfig.failedAttemptsForIpBlock }}"
  FAILED_ATTEMPTS_FOR_DEVICE_BLOCK: "{{ .Values.handler.appConfig.failedAttemptsForDeviceBlock }}"
  FAILED_ATTEMPTS_FOR_CAPTCHA_TRIGGER: "{{ .Values.handler.appConfig.failedAttemptsForCaptchaTrigger }}"
  EVENTS_RETENTION_PERIOD: "{{ .Values.handler.appConfig.eventsRetentionPeriod }}"
  AUTO_EXPIRE_RULE_IN_MINS: "{{ .Values.handler.appConfig.autoExpireRuleInMins }}"
  DEVICE_PROTECTION_ENABLE: "{{ .Values.handler.appConfig.deviceProtectionEnable }}"
  IP_PROTECTION_ENABLE: "{{ .Values.handler.appConfig.ipProtectionEnable }}"
  CAPTCHA_PROTECTION_ENABLE: "{{ .Values.handler.appConfig.captchaProtectionEnable }}"
  NEW_DEVICE_LOGIN_SUBJECT: "{{ .Values.handler.appConfig.newDeviceLoginSubject }}"
  SMTP_HOST: "{{ .Values.handler.appConfig.smtpHost }}"
  SMTP_PORT: "{{ .Values.handler.appConfig.smtpPort }}"
  SMTP_USERNAME: "{{ .Values.handler.appConfig.smtpUsername }}"
  SMTP_PASSWORD: "{{ .Values.handler.appConfig.smtpPassword }}"
  MAIL_FROM: "{{ .Values.handler.appConfig.mailFrom }}"

...
